{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the TeaMaps application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the user."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "reputationScore": {
          "type": "number",
          "description": "The reputation score of the user, used for trust and verification."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Incident": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Incident",
      "type": "object",
      "description": "Represents an incident reported in the TeaMaps application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Incident entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Incident) The user who reported the incident."
        },
        "incidentType": {
          "type": "string",
          "description": "Type of incident (e.g., Fire, Accident, Medical)."
        },
        "locationLatitude": {
          "type": "number",
          "description": "Latitude of the incident location."
        },
        "locationLongitude": {
          "type": "number",
          "description": "Longitude of the incident location."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the photo/video evidence for the incident.",
          "format": "uri"
        },
        "description": {
          "type": "string",
          "description": "Description of the incident."
        },
        "severity": {
          "type": "string",
          "description": "Severity level of the incident (Critical, Warning, Info, Unverified)."
        },
        "status": {
          "type": "string",
          "description": "Verification status of the incident (Unverified, Verifying, Verified)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the incident was reported.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "incidentType",
        "locationLatitude",
        "locationLongitude",
        "severity",
        "status",
        "timestamp"
      ]
    },
    "Verification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Verification",
      "type": "object",
      "description": "Represents a user's verification of an incident.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Verification entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Verification) The user who is verifying the incident."
        },
        "incidentId": {
          "type": "string",
          "description": "Reference to Incident. (Relationship: Incident 1:N Verification) The incident being verified."
        },
        "verificationStatus": {
          "type": "string",
          "description": "The user's verification status (Confirm, Can't Verify, Report as False)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the verification was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "incidentId",
        "verificationStatus",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "phone"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incidents/{incidentId}",
        "definition": {
          "entityName": "Incident",
          "schema": {
            "$ref": "#/backend/entities/Incident"
          },
          "description": "Stores incidents reported by users. Path-based ownership, inheriting from the user document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who reported the incident."
            },
            {
              "name": "incidentId",
              "description": "The unique identifier of the incident."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incidents/{incidentId}/verifications/{verificationId}",
        "definition": {
          "entityName": "Verification",
          "schema": {
            "$ref": "#/backend/entities/Verification"
          },
          "description": "Stores user verifications for incidents. Path-based ownership, inheriting from the incident document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who reported the incident."
            },
            {
              "name": "incidentId",
              "description": "The unique identifier of the incident."
            },
            {
              "name": "verificationId",
              "description": "The unique identifier of the verification."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure prioritizes authorization independence and QAPs. User data is stored under `/users/{userId}`, enabling path-based ownership. Incidents are also stored under the respective user's ID, enabling the User 1:N Incident relationship. Verification records are stored under the respective incident, also following a 1:N relationship. This ensures clear ownership and avoids the need for complex `get()` calls in security rules. All documents within the 'incidents' and 'verifications' subcollections inherit authorization context from their parent user and incident documents respectively, using path-based rules. This design facilitates secure list operations (QAPs) because listing incidents is scoped to the user who created them. Specifically, authorization independence is achieved by not relying on data outside the document to authorize operations. For example, verifying an Incident requires only checking the user performing the verification, the Incident being verified, and no other parent or ancestor attributes."
  }
}